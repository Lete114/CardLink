{"version":3,"file":"cardlink.js","sources":["../src/main.js"],"sourcesContent":["import styles from './main.css'\n\nconst style = createElement('style')\nstyle.textContent = styles\ndocument.head.appendChild(style)\n\nconst proxyHandler = {\n  set(target, name, value) {\n    verifyParams(value, ['title', 'link', 'icon'])\n    name = indexHandler(name)\n    target[name] = value\n    return true\n  }\n}\ncardLink.cache = new Proxy({}, proxyHandler)\n\n/**\n * Remove '/' and '/index.html'\n * @param {String} params\n * @returns { String }\n */\nfunction indexHandler(params) {\n  let path = params.replace(/(\\/index\\.html|\\/)*$/gi, '')\n  if (path.length === 0) path += '/'\n  return path\n}\n\n/**\n * @param {Object} param\n * @param {Array} requiredParams\n */\nfunction verifyParams(param, requiredParams) {\n  for (const index in requiredParams) {\n    const requiredParam = requiredParams[index]\n    if (!param[requiredParam]) {\n      throw new Error(`Parameter '${requiredParam}' not legal`)\n    }\n  }\n}\n\n/**\n * Determine if it is a ['https://', 'http://', '//'] protocol\n * @param {String} url Website url\n * @returns {Boolean}\n */\nfunction isHttp(url) {\n  return /^(https?:)?\\/\\//g.test(url)\n}\n\n/**\n * Creating element\n * @param {String} name Element Name\n * @param {String} className Element className\n * @returns {HTMLElement}\n */\nfunction createElement(name, className) {\n  const dom = document.createElement(name)\n  if (className) dom.className = className\n  return dom\n}\n\n/**\n * Creates svg element\n * @param {String} name Element Name\n * @returns {SVGElementTagNameMap}\n */\nfunction createSVG(name) {\n  return document.createElementNS('http://www.w3.org/2000/svg', name)\n}\n\n/**\n * Set element attribute\n * @param {HTMLElement} el Element\n * @param {Object} obj Objects of key-value pairs\n */\nfunction setAttribute(el, obj) {\n  for (const key in obj) el.setAttribute(key, obj[key])\n}\n\n/**\n * Append child node or element\n * @param {HTMLElement} el Element\n * @param {Node} child The node to append to the given parent node (commonly an element).\n */\nfunction appendChild(el, child) {\n  el.appendChild(child)\n}\n\n/**\n * Create card link icon\n * @param {String} icon Icon URL\n * @returns {SVGElementTagNameMap}\n */\nfunction createIcon(icon) {\n  const svg = createSVG('svg')\n  svg.classList.add('card-link-icon')\n  svg.style.background = '#ebebeb'\n  setAttribute(svg, { fill: '#d4d4d4', viewBox: '0 0 1024 1024' })\n  const path = createSVG('path')\n\n  setAttribute(path, {\n    // eslint-disable-next-line max-len\n    d: 'M177.152 384a357.546667 357.546667 0 0 0-23.552 128 357.546667 357.546667 0 0 0 23.552 128h140.245333a791.808 791.808 0 0 1-10.197333-128c0-44.714667 3.584-87.722667 10.197333-128H177.152z m24.405333-51.2h126.250667c15.786667-65.024 40.021333-120.405333 69.76-160.554667A359.466667 359.466667 0 0 0 201.557333 332.8zM844.8 378.709333V384h-138.197333c6.613333 40.277333 10.197333 83.285333 10.197333 128s-3.584 87.722667-10.197333 128H844.8v5.290667c16.512-41.216 25.6-86.186667 25.6-133.290667a357.418667 357.418667 0 0 0-25.6-133.290667zM822.442667 332.8a359.466667 359.466667 0 0 0-196.010667-160.554667c29.738667 40.149333 53.930667 95.573333 69.76 160.554667h126.293333zM369.365333 384a736.042667 736.042667 0 0 0-10.965333 128c0 45.354667 3.968 88.448 10.965333 128h285.269334c6.997333-39.552 10.965333-82.645333 10.965333-128s-3.968-88.448-10.965333-128H369.365333z m11.264-51.2h262.741334c-28.586667-108.032-80.725333-179.2-131.370667-179.2-50.645333 0-102.741333 71.168-131.370667 179.2z m-179.072 358.4a359.466667 359.466667 0 0 0 196.010667 160.554667c-29.738667-40.149333-53.930667-95.573333-69.76-160.554667h-126.293333z m620.885334 0h-126.250667c-15.786667 65.024-40.021333 120.405333-69.76 160.554667a359.466667 359.466667 0 0 0 196.010667-160.554667z m-441.813334 0c28.586667 108.032 80.725333 179.2 131.370667 179.2 50.645333 0 102.741333-71.168 131.370667-179.2H380.629333zM512 921.6a409.6 409.6 0 1 1 0-819.2 409.6 409.6 0 0 1 0 819.2z'\n  })\n  appendChild(svg, path)\n\n  const img = createElement('img', 'card-link-icon')\n  img.src = icon\n\n  // If icon is valid, replace `svgIcon` with `imgIcon`\n  img.onload = function () {\n    img.onload = null\n    svg.parentNode.replaceChild(img, svg)\n  }\n  return svg\n}\n\n/**\n * Creating a Document Object Model\n * @param {String} title Website title\n * @param {String} link Website address\n * @param {String} icon Website icon\n * @returns {HTMLElement}\n */\n// eslint-disable-next-line max-statements\nfunction createDOM(title, link, icon) {\n  const wrapDOM = createElement('div', 'card-link')\n  const iconDOM = createIcon(icon)\n\n  const aDOM = createElement('a', 'card-link-content')\n  aDOM.href = link\n\n  const textDOM = createElement('div', 'card-link-text')\n\n  const titleDOM = createElement('span', 'card-link-title')\n  titleDOM.textContent = title\n\n  const linkDOM = createElement('span', 'card-link-url')\n\n  const linkSvgDOM = createSVG('svg')\n  setAttribute(linkSvgDOM, {\n    width: 14,\n    height: 14,\n    viewBox: '0 0 24 24',\n    fill: 'currentColor'\n  })\n\n  const linkPathDOM = createSVG('path')\n  setAttribute(linkPathDOM, {\n    // eslint-disable-next-line max-len\n    d: 'M5.327 18.883a3.005 3.005 0 010-4.25l2.608-2.607a.75.75 0 10-1.06-1.06l-2.608 2.607a4.505 4.505 0 006.37 6.37l2.608-2.607a.75.75 0 00-1.06-1.06l-2.608 2.607a3.005 3.005 0 01-4.25 0zm5.428-11.799a.75.75 0 001.06 1.06L14.48 5.48a3.005 3.005 0 014.25 4.25l-2.665 2.665a.75.75 0 001.061 1.06l2.665-2.664a4.505 4.505 0 00-6.371-6.372l-2.665 2.665zm5.323 2.117a.75.75 0 10-1.06-1.06l-7.072 7.07a.75.75 0 001.061 1.06l7.071-7.07z'\n  })\n\n  appendChild(linkSvgDOM, linkPathDOM)\n  appendChild(linkDOM, linkSvgDOM)\n  appendChild(linkDOM, document.createTextNode(link))\n\n  appendChild(textDOM, titleDOM)\n  appendChild(textDOM, linkDOM)\n  appendChild(aDOM, textDOM)\n  appendChild(aDOM, iconDOM)\n  appendChild(wrapDOM, aDOM)\n  return wrapDOM\n}\n\nfunction renderer(el, title, link, icon) {\n  const dom = createDOM(title, link, icon)\n\n  // Reset the attribute\n  Array.from(el.attributes).forEach((attr) => {\n    dom.querySelector('a').setAttribute(attr.name, attr.value)\n  })\n  el.parentNode.replaceChild(dom, el)\n}\n\n/**\n * Get info\n * @param {Element} el Element\n * @param {String} html String type html\n * @param {String} link Website address\n */\n// eslint-disable-next-line max-statements\nfunction getInfo(el, html, link) {\n  try {\n    let title, icon\n    const doc = new DOMParser().parseFromString(html, 'text/html')\n    // If there is no title, no card link is generated\n    title = doc.querySelector('title')\n    if (title) {\n      title = title.textContent\n\n      // Get the src of the first img tag in the body tag\n      icon = doc.querySelector('body img')\n      icon = icon && icon.getAttribute('src')\n\n      if (/^data:image/.test(icon)) icon = ''\n\n      // If there is no src then get the site icon\n      if (!icon) {\n        const links = [].slice.call(doc.querySelectorAll('link[rel][href]'))\n        icon = links.find((_el) => _el.rel.includes('icon'))\n        icon = icon && icon.getAttribute('href')\n      }\n\n      // If `icon` is not the ['https://', 'http://', '//'] protocol, splice on the `origin` of the a tag\n      if (!isHttp(icon)) icon = new URL(link).origin + icon\n\n      cardLink.cache[link] = { title, link, icon }\n\n      renderer(el, title, link, icon)\n    }\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.warn('CardLink Error: Failed to parse', error)\n  }\n}\n\nfunction fetchPage(link, callback) {\n  fetch(link)\n    .then((result) => result.text())\n    .then(callback)\n    .catch((error) => {\n      const server = cardLink.server\n      // eslint-disable-next-line no-console\n      if (link.includes(server) || !server) return console.error('CardLink Error:', error)\n      fetchPage(server + link, callback)\n    })\n}\n\n/**\n * Create card links\n * @param {NodeList} nodes A collection of nodes or a collection of arrays,\n * if it is an array then the array must always contain node element\n */\nexport default function cardLink(nodes) {\n  // If the `nodes` do not contain a `forEach` method, then the default `a[cardlink]` is used\n  nodes = 'forEach' in (nodes || {}) ? nodes : document.querySelectorAll('a[cardlink]')\n  nodes.forEach((el) => {\n    // If it is not a tag element then it is not processed\n    if (el.nodeType !== 1) return\n    el.removeAttribute('cardlink')\n    const link = el.href\n\n    const cache = cardLink.cache[link]\n    if (cache) return renderer(el, cache.title, cache.link, cache.icon)\n\n    if (isHttp(link)) {\n      fetchPage(link, (html) => {\n        getInfo(el, html, link)\n      })\n    }\n  })\n}\n"],"names":["style","createElement","textContent","document","head","appendChild","proxyHandler","set","target","name","value","param","requiredParams","index","requiredParam","Error","verifyParams","params","path","replace","length","indexHandler","isHttp","url","test","className","dom","createSVG","createElementNS","setAttribute","el","obj","key","child","createDOM","title","link","icon","wrapDOM","iconDOM","svg","classList","add","background","fill","viewBox","d","img","src","onload","parentNode","replaceChild","createIcon","aDOM","href","textDOM","titleDOM","linkDOM","linkSvgDOM","width","height","linkPathDOM","createTextNode","renderer","Array","from","attributes","forEach","attr","querySelector","fetchPage","callback","fetch","then","result","text","error","server","cardLink","includes","console","nodes","querySelectorAll","nodeType","removeAttribute","cache","html","doc","DOMParser","parseFromString","getAttribute","slice","call","find","_el","rel","URL","origin","warn","getInfo","Proxy"],"mappings":"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"}